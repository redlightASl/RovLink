# RovLink 物理层标准

在当前标准下，RovLink可以使用如下通用板级总线传输：

* 标准TTL（3.3V/5V）串口
* 标准RS232串口

在当前标准下，RovLink可以使用如下现场总线传输：

* 标准RS485串口
* 标准RS422串口
* CAN总线
* 百兆/千兆ETH以太网

除此之外，RovLink还对设备的片上外设进行了规定，并允许基于硬件（FPGA或CPLD）的协议栈实现

## 各种接口下的RovLink实现规范

### TTL串口

* 不对串口电平作强制要求，仅需完成可靠传输
* 要求串口波特率至少为115200
* 使用8数据位，1停止位，无奇偶校验位，无流控

### RS232接口

* 要求串口波特率至少为115200
* 使用8数据位，1停止位，无奇偶校验位
* 不允许全双工软件流控，需使用硬件流控（CTS/RTS）或不使用流控

### 标准RS485接口

* 要求接口处安装TVS器件以防止误码
* 要求串口波特率至少为115200
* 使用8数据位，1停止位，无奇偶校验位
* 允许半双工软件流控，也可使用硬件流控（DE）或不使用流控

### 标准RS422接口

* 要求接口处安装TVS器件以防止误码
* *推荐*使用信号参考地线以防止误码
* 要求串口波特率至少为115200
* 不允许使用双路RS485模拟RS422的方式，这可能导致RovLink和驱动框架不兼容
* 使用8数据位，1停止位，无奇偶校验位
* 要求使用全双工422通信，需将RE和DE使能

### CAN总线

* 必须使用RovLink的Inner Frame在CAN总线上传输，且将DLC设置为8
* 要求线束双绞
* *推荐*在线束旁接入参考地线或进行屏蔽包层处理
* 要求CAN波特率至少为1M
* RovLink只能在数据帧上传输，禁止使用遥控帧（RTR设置为0，IDE设置为0）
* 启用自动重传
* 禁用接收FIFO锁定
* 所有RovLink具有同等优先级，因此按照FIFO顺序发送邮箱，禁止以ID优先级发送
* 允许以单CAN总线连接来进行路由，但要求使用11位标准CAN ID，每个CAN设备的地址都应当设置为当前主控所属的舱位值，传输时必须指定目标设备ID
* 要求使用掩码模式黑名单配置CAN过滤器

### 以太网

* 不允许直接使用RMII/RGMII发送RovLink数据
* RovLink应当基于TCP/UDP协议Socket传输，也允许基于WebSocket的RovLink传输方式
* 所有RovLink设备应当置于同一网段内

## RovLink接口抽象

规定支持RovLink的设备至少保留一个用于板级通信的片上外设，实现设备与上位机或者中间设备的联通。这个片上外设对应的接口被称为 `LinkCOM` 。协议要求与该接口实现有关的软件/硬件变量命名或函数命名应当带有 `Link` 或 `link` 字样。

为使RovLink路由能够进行，设备至少应保留两个可用的板级通信接口，如果设备有且只有两个接口，其中一个接口是`LinkCOM`，需要将另一个接口唯一定义为`PassCOM`，并在与该接口实现有关的软件/硬件变量或函数命名中体现`Pass`或`pass`字样。

如果设备使用到三个或以上的接口用于路由，只需要指定一个 `LinkCOM` 而无需指定 `PassCOM`

