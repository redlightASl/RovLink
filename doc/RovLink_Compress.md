# RovLink 压缩指令帧

RovLink支持32位（总长度4字节）的**压缩指令帧**，在片上总线（如AXI-Lite）和高速模拟总线（如LVDS）上，RovLink可以通过压缩指令帧完成单周期数据交换。

> [!NOTE]
>
> 本文档介绍压缩指令帧的格式和基本要求

## 压缩帧指令格式

> 压缩帧由RovLink内部帧进一步处理得到。它将内部帧的数据类型缩短为6bit，并修改特征指示为2bit，从而支持片上总线/协处理器应用。

压缩帧具有两种基本格式，分别用于直接控制数据（立即数型）和从地址控制数据（访存型），称为TypeA和TypeB。帧内存在2bit长度的**特征指示**段，被称为**funct**，其高位决定了本帧是哪种基本数据格式，即数据长度码DLC。funct的低位是后继指示位，为了与标准帧对应，该位称为Sbit

funct段的组织格式如下表所示

| 特征指示   | 数据长度码        | 后继指示位           |
| ---------- | ----------------- | -------------------- |
| 标志位     | DLC               | Sbit                 |
| 数据长度   | 1bit              | 1bit                 |
| =0时的功能 | 本帧为TypeA压缩帧 | 本帧为独立帧或结束帧 |
| =1时的功能 | 本帧为TypeB压缩帧 | 本帧有后继帧         |

压缩帧A的格式如下表所示

| 数据段0 | 数据段1 | 数据段2 | 数据类型 | 特征指示 |
| ------- | ------- | ------- | -------- | -------- |
| d0      | d1      | d2      | opcode   | funct    |
| 8bit    | 8bit    | 8bit    | 6bit     | 2bit     |

其数据段0-2均为实际数据，数据类型段决定了本帧的功能

压缩帧B的格式如下表所示

| 数据段0 | 数据段1 | 数据类型 | 特征指示 |
| ------- | ------- | -------- | -------- |
| d0      | d1      | opcode   | funct    |
| 16bit   | 8bit    | 6bit     | 2bit     |

其数据段0为寄存器地址，数据段1为实际数据或寄存器地址，数据类型段决定了本帧的功能

## RovLink片上突发传输

RovLink通过后继有效位实现了突发传输功能，具体传输方式与标准协议一致。

## 支持RovLink的片上设备

如果一个片上设备或接口支持RovLink，它应当在内部维护一个8KB以下容量的共享内存（Shared Memory）或内存映射IO寄存器（Memory Mapped IO Register），从而让主机CPU通过压缩帧B完成读写操作。

压缩帧A通常用于向RovLink片上设备直接写入数据，从而完成模式修改、运行微调等工作。

